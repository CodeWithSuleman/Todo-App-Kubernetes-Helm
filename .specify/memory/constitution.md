<!--
Sync Impact Report
---
Version change: 1.0.0 → 1.1.0
Modified principles:
- Specification-driven development → Specification-driven development
- Security-first architecture → Security-first architecture
- Clear separation of concerns → Clear separation of concerns
- Deterministic, reproducible agent execution → Deterministic, reproducible agent execution
- Production-readiness over demo-only shortcuts → Production-readiness over demo-only shortcuts
Added sections:
- Core Principles (VI. Agent-first, tool-based execution only)
- Core Principles (VII. Stateless services with database-persisted context)
- Core Principles (VIII. Deterministic and reproducible AI behavior)
- Key Standards (AI agents may act only via MCP tools)
- Key Standards (MCP tools must be stateless and enforce user authorization)
- Key Standards (All agent tool calls must be logged and traceable)
- Key Standards (No AI-initiated direct database access)
- Security Standards (Chat endpoints require JWT authentication)
- Security Standards (User identity must come from JWT, not user input)
- Security Standards (Cross-user access is strictly forbidden)
- Security Standards (Unauthorized access returns 401/403)
- Persistence Rules (Conversation and message history must be stored in database)
- Persistence Rules (Server must reconstruct context on every request)
- Persistence Rules (System must function correctly after server restart)
- Success Criteria (Users can manage todos via natural language)
- Success Criteria (AI correctly selects and executes MCP tools)
- Success Criteria (Conversation context resumes reliably)
- Success Criteria (System remains stateless and secure)
Removed sections:
Templates requiring updates:
- ⚠️ .specify/templates/plan-template.md
- ⚠️ .specify/templates/spec-template.md
- ⚠️ .specify/templates/tasks-template.md
- ⚠️ .specify/templates/commands/sp.constitution.md
Follow-up TODOs:
-->

# Full-Stack Multi-User Todo Web Application (Agentic Dev Stack) Constitution

## Core Principles

### I. Specification-driven development
Every feature must be traceable to a written specification. No manual coding is permitted; all implementation must be generated by the agent based on the spec.

### II. Security-first architecture
The system must be designed with security as the primary consideration, employing JWT-based authentication and authorization for all protected resources.

### III. Clear separation of concerns
A strict division must be maintained between the frontend, backend, authentication, and data layers to ensure modularity and maintainability.

### IV. Deterministic, reproducible agent execution
The agent's behavior must be deterministic and reproducible to ensure consistent outcomes from the same inputs and specifications.

### V. Production-readiness over demo-only shortcuts
All development must prioritize production-level quality, avoiding shortcuts that are unsuitable for a real-world deployment environment.

### VI. Agent-first, tool-based execution only
AI agents may act only via MCP tools. All agent behaviors must be mediated through standardized interfaces rather than direct system manipulation.

### VII. Stateless services with database-persisted context
Services must maintain no in-memory state between requests. All context must be persisted in the database and reconstructed on demand to ensure scalability and reliability.

### VIII. Deterministic and reproducible AI behavior
AI behavior must be consistent and predictable, producing the same outputs for identical inputs and specifications to ensure system reliability and debuggability.

## Key Standards
- All features must be traceable to written specifications.
- The REST API must strictly follow defined endpoints and HTTP semantics.
- Authentication must be enforced on every protected route.
- User data isolation must be guaranteed at the API and database level.
- All generated code must align with the declared tech stack only.
- AI agents may act only via MCP tools.
- MCP tools must be stateless and enforce user authorization.
- All agent tool calls must be logged and traceable.
- No AI-initiated direct database access.

## Technology Constraints
- **Frontend**: Next.js 16+ (App Router)
- **Backend**: Python FastAPI
- **ORM**: SQLModel
- **Database**: Neon Serverless PostgreSQL
- **Authentication**: Better Auth (JWT-based)
- No additional frameworks or auth systems are allowed.

## Security Standards
- All API endpoints require valid JWT authentication.
- JWT verification must occur server-side in FastAPI.
- The shared secret must be sourced from environment variables.
- The User ID from the JWT must match the route-level user context.
- Unauthorized requests must return HTTP 401.
- Cross-user data access is strictly forbidden.
- Chat endpoints require JWT authentication.
- User identity must come from JWT, not user input.
- Cross-user access is strictly forbidden.
- Unauthorized access returns 401/403.

## Development Constraints
- No manual code edits are allowed.
- Development must follow the sequence: Spec → Plan → Tasks → Implementation.
- Each phase must be reviewable and auditable.
- The backend and frontend must operate as independent services.
- Stateless authentication is required (no backend session storage).

## Persistence Rules
- Conversation and message history must be stored in database.
- Server must reconstruct context on every request.
- System must function correctly after server restart.

## Functional Requirements
- Implement all 5 Basic Level Todo features.
- Use persistent storage with PostgreSQL.
- Implement RESTful CRUD operations for tasks.
- Enforce task ownership on every operation.
- The frontend interface must be responsive and multi-user.

## Quality Requirements
- Code must be readable, modular, and maintainable.
- API responses must use consistent schemas.
- Proper error handling and status codes are required.
- Database migrations must be deterministic.
- Configuration must be environment-based (no hardcoded secrets).

## Success Criteria
- All specs are fully implemented without deviations.
- All API endpoints are secured and functional.
- Users can only access their own tasks.
- JWT-based authentication is verified end-to-end.
- The application runs successfully in a real deployment environment.
- The project demonstrates a complete Agentic Dev Stack workflow.
- Users can manage todos via natural language.
- AI correctly selects and executes MCP tools.
- Conversation context resumes reliably.
- System remains stateless and secure.

## Governance
This constitution supersedes all other practices. Amendments require documentation, approval, and a migration plan. All pull requests and reviews must verify compliance with this constitution. Complexity must be justified.

**Version**: 1.1.0 | **Ratified**: 2026-01-28 | **Last Amended**: 2026-02-05